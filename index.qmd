---
title: "Biomedical Data Science (BDS) Workshop 1: \n Basic R operations, tidyverse (Part 1)"
format: html
engine: knitr
filters:
  - webr
webr:
  packages: ['dplyr', 'tidyr', 'tidyverse']
---

```{webr-r}
#| context: setup
# Load hoffman toy data
download.file("https://raw.githubusercontent.com/rich2355/Biomedical_Data_Science_Club_Materials/main/test_data.csv", "test_data.csv")
df <- read.csv("test_data.csv")
```

This is a webR-enabled code cell in a Quarto HTML document.

# Credits

Credited to Richard Liu and Emily Zhang from the Biomedical Data Science (BDS) club in NYU Langone Health. 

# Disclaimer

The datasets provided here are all synthetically generated for demonstration and educational purposes only. It does not represent real patient data and should not be used for clinical decision-making, medical research, or policy development. Any resemblance to real persons, conditions, or outcomes is purely coincidental. The values and relationships were generated using statistical simulation techniques and do not reflect actual medical situations.

# Table of Contents

- 
-
-

# Basic R Operations 

## Math Operators 

`+`, `-`, `*`, `/`, `^`, `%%`

```{webr-r}
7 + 5
```

```{webr-r}
7 ^ 5
```

```{webr-r}
12 / 5
```

```{webr-r}
12 %% 5
```

## Comparison Operators 

`>`, `<`, `>=`, `<=`, `==`, `!=`

```{webr-r}
7 > 5
!7
```

```{webr-r}
head(df)
```

## Logical Operators 

`&`, `|`

```{webr-r}
(5 > 7) & (6 * 7 == 42)
(5 > 7) | (6 * 7 == 42)
(5 > 7) | (6 * 7 == 42) & (5 > 7) | (6 * 7 == 42)
```
::: {.callout-note}
Operators have their own rankings. `&` is ranked higher than `|`.
:::

::: {.callout-caution collapse="true"}
## Quiz 1
Identify the boolean value of the following expression:

`(5 < 7) | (6 * 7 == 42) & (5 < 7) & (6 * 7 != 42)`

```{webr-r}
# You can check it here, but please first think for a while...
```

To avoid confusion, what would be a better way to write this script?
:::

## Vectors 

```{webr-r}
x = c(7, 8, 10, 45)
x
length(x)
```

```{webr-r}
# Recycling, vectorize
x + c(-7, -8)
x > 9
```

```{webr-r}
# Indexing
x[3]
x[3:5]
x[c(2, 4)]
x[-3]
x[-1]
```

```{webr-r}
places = which(x > 9)
places
x[places]
```

::: {.callout-caution collapse="true"}
## Quiz 2

Create a vector `y`, write code to obtain `z` such that $y = \max(z, 0)$, where $\max(\cdot)$ is defined element-wise.

```{webr-r}
# Code

```

Any subtle issue?
:::

## Matrix

```{webr-r}
z.mat = matrix(c(40,1,60,3), nrow=2)
z.mat
```

```{webr-r}
z.mat[2,2]
z.mat[,2]
z.mat[1,]
```

```{webr-r}
# Summary result of a matrix
rowSums(z.mat)
colSums(z.mat)
rowMeans(z.mat)
colMeans(z.mat)
diag(z.mat)
```

```{webr-r}
four.sevens = matrix(rep(7,4), ncol=2)
four.sevens
```

```{webr-r}
z.mat * four.sevens

# Matrix Multiplication
z.mat %*% four.sevens
```

## Data frames 

I asked GPT how to create a data frame, and it tells me I can do this:

```{webr-r}
# Create vectors
id <- 1:5
name <- c("Alice", "Bob", "Charlie", "Diana", "Ethan")
age <- c(25, 30, 35, 28, 40)
treatment <- c("Control", "Treatment", "Treatment", "Control", "Treatment")

# Combine into a data frame
data <- data.frame(
  ID = id,
  Name = name,
  Age = age,
  Treatment = treatment
)

data
```

```{webr-r}
data$ID
data[1,]
```

## Control Flow

```{webr-r}
x = 0.5

if (x >= 0) {
  x
} else {
  -x
}
```

```{webr-r}
x = -2

if (x^2 < 1) {
  x^2 
} else if (x >= 1) {
  2*x-1
} else {
 -2*x+1
}
```

::: {.callout-caution collapse="true"}
## Quiz 3

Write code to display the following if-else logic: If a patient's `age` is between 26 and 35 (left inclusive, same after), then he/she is "young"; if a patient's `age` is between 36 and 50, then he/she is "middle aged"; if a patient's `age` is older than 50, then he/she is "old". 

```{webr-r}
# Code

```

Is this a good encoding? 
:::

## Iteration

```{webr-r}
log.vec = vector(length=5, mode="numeric")
for (i in 1:5) {
  log.vec[i] = log(i)
}
log.vec
```

```{webr-r}
i = 1
log.vec = c()
while (log(i) <= 2) {
  log.vec = c(log.vec, log(i))
  i = i+1
}
log.vec
```

::: {.callout-note}
What is `while(TRUE)`?
:::

::: {.callout-caution collapse="true"}
## Quiz 4

Write code to calculate $\sum_{x = 1}^5 x^2$. Please come up with two different approaches.

```{webr-r}
# Code

```

```{webr-r}
# Code

```

Which one is better?
:::

## Data Frame Basics

```{webr-r}
df
head(df)
```
```{webr-r}
df$Age
df[,"Age"]
df[,c("Age", "Sex")]
df[1,]
```

```{webr-r}
df2 <- df
df2$Test <- rep(1, nrow(df))
colnames(df2)
df2
```

```{webr-r}
df[df$Age > 50,]
```

::: {.callout-caution collapse="true"}
## Quiz 5
In the dataset `df`,

1. subset all white patients, how many?

```{webr-r}
# Code
```
2. subset all patients taking the treatment (instead of taking the control).

```{webr-r}
# Code
```

:::

```{webr-r}
# Read the data using readr package.
```


# References

- [CMU Statistics 36-350: Statistical Computing](https://www.stat.cmu.edu/~ryantibs/statcomp/) Lecture 1-3

<!-- set.seed(42)

# Sample size
n <- 500

# Treatment assignment (0 = control, 1 = treated)
treatment <- rbinom(n, 1, 0.5)

# Demographics
age <- round(rnorm(n, mean = 60, sd = 12))  # Age in years
sex <- sample(c("Male", "Female"), size = n, replace = TRUE)
race <- sample(c("White", "Black", "Asian", "Hispanic", "Other"),
               size = n, replace = TRUE,
               prob = c(0.5, 0.2, 0.15, 0.1, 0.05))

# Kidney measures
baseline_egfr <- rnorm(n, mean = 90 - 5*treatment, sd = 15)
creatinine <- rnorm(n, mean = 1.0 + 0.2*treatment, sd = 0.3)
albuminuria <- rgamma(n, shape = 2, scale = 50 + 20*treatment)

# Outcome (kidney disease progression)
logit_p <- -2 + 0.8*creatinine - 0.02*baseline_egfr - 0.5*treatment
p_outcome <- 1 / (1 + exp(-logit_p))
progression <- rbinom(n, 1, p_outcome)

# Combine into data frame
df <- data.frame(
  Age = age,
  Sex = sex,
  Race = race,
  Treatment = treatment,
  Baseline_eGFR = baseline_egfr,
  Creatinine = creatinine,
  Albuminuria = albuminuria,
  Progression = progression
)
-->
